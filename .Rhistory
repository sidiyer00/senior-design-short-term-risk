trix,
volatility
)
indicator_df = indicator_df[complete.cases(indicator_df), ] # not lagged or logs
library(corrplot)
corrplot(cor(indicator_df, use = "complete.obs"), method = "number")
indicator_df2 = data.frame(
Delt(sma,type='arithmetic'),
Delt(cci,type='arithmetic'),
Delt(cmo,type='arithmetic'),
Delt(macd,type='arithmetic'),
Delt(bbands,type='arithmetic'),
Delt(fastD,type='arithmetic'),
Delt(slowD,type='arithmetic'),
Delt(tdi,type='arithmetic'),
Delt(volatility,type='arithmetic'),
Delt(data$Euro.Spot...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.TSA.Checkpoint.Numbers.Total.Traveler.Throughput...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Bloomberg.United.States.Financial.Conditions.Index...Last.Price..R2.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$CBOE.Equity.Put.Call.Ratio...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.Put.Call.Ratio.Composite...Last.Price..L1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Bloomberg.Cumulative.Advance.Decline.Line.for.S.P.500...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$McClellans.Advances...Declines.US.Index.Summation...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$S.P.500.Composite.Volume.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Cboe.Realized.Volatility.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Cboe.Implied.Correlation.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Base.Metals.Spot.Price.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic")
)
colnames(indicator_df2) <- c("sma", "cci", "cmo", "macd", "bbands", "fastD", "slowD", "tdi", "vol", "EuroSpot", "US TSA Numbers", "BBG Financial Conditions", "CBOE Equity Put/Call", "US Put Call Composite", "BBG Adv/Dec SPX", "US Adv/Dec", "SPX Composite Volume", "CBOE rVol", "CBOE Implied Cor.", "Base Metals Spot Index")
rownames(indicator_df2) <- rownames(price_data)
View(indicator_df2)
View(vxxReturns)
nrow(indicator_df2[1:(nrow(indicator_df2)-5),])
nrow(vxxReturns[6:(nrow(vxxReturns)),])
###########################################################################################################################
### This modifies the lag of the model - change 7 to what you want the lag to be, and change 6 to your desired lag - 1 on the next line
#############################################################################
lag = 5
lagged_df2 <- indicator_df2[1:(nrow(indicator_df2)-lag),]
lagged_df2$vxxReturns <-  vxxReturns[(lag+1):(nrow(vxxReturns)),]
lagged_df2 <- na.omit(lagged_df2)
lagged_df2 <- lagged_df2[!is.infinite(rowSums(lagged_df2)),]
View(lagged_df2)
#indicator_df2 = indicator_df2[-na.omit(indicator_df2), ]
corrplot(cor(lagged_df2, use = "complete.obs"), method = "pie")
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
lin.pred=predict(lin.mod,lagged_df2[train,])
mean((lin.pred-lagged_df2$vxxReturns[train])^2)
summary(lin.mod)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
```
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
lin.pred=predict(lin.mod,lagged_df2[train,])
mean((lin.pred-lagged_df2$vxxReturns[train])^2)
summary(lin.mod)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
lin.pred=predict(lin.mod,lagged_df2[train,])
mean((lin.pred-lagged_df2$vxxReturns[train])^2)
summary(lin.mod)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
summary(lin.mod)
mean((lagged_df2$vxxReturns[train] - predict(lin.mod, lagged_df2[train,]))^2)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
library(tree)
lagged_df2 <- data.frame(lagged_df2)
tree.reg = tree(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
mean((lagged_df2$vxxReturns[train] - predict(tree.reg, lagged_df2[train,]))^2) #Training MSE
y.tree.pred = predict(tree.reg, lagged_df2[-train,]) # Predict with the single regression tree
tree.MSE = mean((lagged_df2$vxxReturns[-train] - y.tree.pred)^2)
tree.MSE #Test MSE
library(randomForest)
rf.reg = randomForest(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train,mtry=3,ntree=300,importance=TRUE)
rf.reg #Gives both the number of variables at each split but also provides out-of-bag estimate of error rate
mean((lagged_df2$vxxReturns[train] - predict(rf.reg, lagged_df2[train,]))^2) # Train MSE
y.rf.pred = predict(rf.reg, lagged_df2[-train,])
rf.MSE = mean((lagged_df2$vxxReturns[-train] - y.rf.pred)^2)
rf.MSE # Test MSE
mean((lagged_df2$vxxReturns[train] - predict(rf.reg, lagged_df2[train,]))^2) # Train MSE
rf.MSE # Test MSE
getSymbols(symbols, from="2021-01-02", to="2021-11-11")
price_data = data.frame(SPY$SPY.Adjusted,VXX$VXX.Adjusted)
colnames(price_data) <- symbols
getSymbols(symbols, from="2021-01-02", to="2021-11-11")
price_data = data.frame(SPY$SPY.Adjusted,VXX$VXX.Adjusted)
colnames(price_data) <- symbols
# all indicators related to the SPY
indicator_df2 = data.frame(
# Delt(sma,type='arithmetic'),
#Delt(cci,type='arithmetic'),
#Delt(cmo,type='arithmetic'),
#Delt(macd,type='arithmetic'),
#Delt(bbands,type='arithmetic'),
#Delt(fastD,type='arithmetic'),
#Delt(slowD,type='arithmetic'),
#Delt(tdi,type='arithmetic'),
#Delt(volatility,type='arithmetic'),
Delt(data$Euro.Spot...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.TSA.Checkpoint.Numbers.Total.Traveler.Throughput...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$Bloomberg.United.States.Financial.Conditions.Index...Last.Price..R2.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$CBOE.Equity.Put.Call.Ratio...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$US.Put.Call.Ratio.Composite...Last.Price..L1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$Bloomberg.Cumulative.Advance.Decline.Line.for.S.P.500...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$McClellans.Advances...Declines.US.Index.Summation...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$S.P.500.Composite.Volume.Index...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$Cboe.Realized.Volatility.Index...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$Cboe.Implied.Correlation.Index...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic"),
Delt(data$Base.Metals.Spot.Price.Index...Last.Price..R1.[which(data$date == "1/4/2021"):which(data$date == "11/11/2021")],type = "arithmetic")
)
library(quantmod)
symbols <- c("SPY", "VXX")
getSymbols(symbols, from="2019-01-02", to="2021-01-01")
price_data = data.frame(SPY$SPY.Adjusted,VXX$VXX.Adjusted)
colnames(price_data) <- symbols
data = read.csv("data_gathering (2).csv")
library(TTR)
# all indicators related to the SPY
sma = as.numeric(SMA(price_data[,1]))
cci = as.numeric(CCI(price_data[,1]))
cmo = as.numeric(CMO(price_data[,1]))
macd = as.numeric(MACD(price_data[,1])[,1])
bbands = as.numeric(BBands(price_data[,1])[,4])
runSum = as.numeric(runSum(price_data[,1]))
fastK= as.numeric(stoch(price_data[,1])[,1])
fastD = as.numeric(stoch(price_data[,1])[,2])
slowD = as.numeric(stoch(price_data[,1])[,3])
tdi = as.numeric(TDI(price_data[,1])[,1])
trix = as.numeric(TRIX(price_data[,1])[,1])
volatility = as.numeric(volatility(price_data[,1]))
wpr = as.numeric(WPR(price_data[,1]))
# VXX daily returns
vxxReturns = dailyReturn(VXX, type="log")
indicator_df = data.frame(
sma,
cci,
cmo,
macd,
bbands,
fastK,
fastD,
slowD,
tdi,
trix,
volatility
)
indicator_df = indicator_df[complete.cases(indicator_df), ] # not lagged or logs
library(corrplot)
corrplot(cor(indicator_df, use = "complete.obs"), method = "number")
#% change df
library(TTR)
# all indicators related to the SPY
sma = as.numeric(SMA(price_data[,1]))
cci = as.numeric(CCI(price_data[,1]))
cmo = as.numeric(CMO(price_data[,1]))
macd = as.numeric(MACD(price_data[,1])[,1])
bbands = as.numeric(BBands(price_data[,1])[,4])
runSum = as.numeric(runSum(price_data[,1]))
fastK= as.numeric(stoch(price_data[,1])[,1])
fastD = as.numeric(stoch(price_data[,1])[,2])
slowD = as.numeric(stoch(price_data[,1])[,3])
tdi = as.numeric(TDI(price_data[,1])[,1])
trix = as.numeric(TRIX(price_data[,1])[,1])
volatility = as.numeric(volatility(price_data[,1]))
wpr = as.numeric(WPR(price_data[,1]))
zigZag = as.numeric(ZigZag(price_data[,1]))
# VXX daily returns
vxxReturns = dailyReturn(VXX, type="log")
indicator_df = data.frame(
sma,
cci,
cmo,
macd,
bbands,
fastK,
fastD,
slowD,
tdi,
trix,
volatility
)
indicator_df = indicator_df[complete.cases(indicator_df), ] # not lagged or logs
library(corrplot)
corrplot(cor(indicator_df, use = "complete.obs"), method = "number")
indicator_df2 = data.frame(
Delt(sma,type='arithmetic'),
Delt(cci,type='arithmetic'),
Delt(cmo,type='arithmetic'),
Delt(macd,type='arithmetic'),
Delt(bbands,type='arithmetic'),
Delt(fastD,type='arithmetic'),
Delt(slowD,type='arithmetic'),
Delt(tdi,type='arithmetic'),
Delt(volatility,type='arithmetic'),
Delt(data$Euro.Spot...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.TSA.Checkpoint.Numbers.Total.Traveler.Throughput...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Bloomberg.United.States.Financial.Conditions.Index...Last.Price..R2.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$CBOE.Equity.Put.Call.Ratio...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.Put.Call.Ratio.Composite...Last.Price..L1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Bloomberg.Cumulative.Advance.Decline.Line.for.S.P.500...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$McClellans.Advances...Declines.US.Index.Summation...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$S.P.500.Composite.Volume.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Cboe.Realized.Volatility.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Cboe.Implied.Correlation.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Base.Metals.Spot.Price.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic")
)
colnames(indicator_df2) <- c("sma", "cci", "cmo", "macd", "bbands", "fastD", "slowD", "tdi", "vol", "EuroSpot", "US TSA Numbers", "BBG Financial Conditions", "CBOE Equity Put/Call", "US Put Call Composite", "BBG Adv/Dec SPX", "US Adv/Dec", "SPX Composite Volume", "CBOE rVol", "CBOE Implied Cor.", "Base Metals Spot Index")
rownames(indicator_df2) <- rownames(price_data)
View(indicator_df2)
View(vxxReturns)
nrow(indicator_df2[1:(nrow(indicator_df2)-5),])
nrow(vxxReturns[6:(nrow(vxxReturns)),])
###########################################################################################################################
### This modifies the lag of the model - change 7 to what you want the lag to be, and change 6 to your desired lag - 1 on the next line
#############################################################################
lag = 5
lagged_df2 <- indicator_df2[1:(nrow(indicator_df2)-lag),]
lagged_df2$vxxReturns <-  vxxReturns[(lag+1):(nrow(vxxReturns)),]
lagged_df2 <- na.omit(lagged_df2)
lagged_df2 <- lagged_df2[!is.infinite(rowSums(lagged_df2)),]
View(lagged_df2)
#indicator_df2 = indicator_df2[-na.omit(indicator_df2), ]
corrplot(cor(lagged_df2, use = "complete.obs"), method = "pie")
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
lin.pred=predict(lin.mod,lagged_df2[train,])
mean((lin.pred-lagged_df2$vxxReturns[train])^2)
summary(lin.mod)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
library(TTR)
# all indicators related to the SPY
sma = as.numeric(SMA(price_data[,1]))
cci = as.numeric(CCI(price_data[,1]))
cmo = as.numeric(CMO(price_data[,1]))
macd = as.numeric(MACD(price_data[,1])[,1])
bbands = as.numeric(BBands(price_data[,1])[,4])
runSum = as.numeric(runSum(price_data[,1]))
fastK= as.numeric(stoch(price_data[,1])[,1])
fastD = as.numeric(stoch(price_data[,1])[,2])
slowD = as.numeric(stoch(price_data[,1])[,3])
tdi = as.numeric(TDI(price_data[,1])[,1])
trix = as.numeric(TRIX(price_data[,1])[,1])
volatility = as.numeric(volatility(price_data[,1]))
wpr = as.numeric(WPR(price_data[,1]))
zigZag = as.numeric(ZigZag(price_data[,1]))
# VXX daily returns
vxxReturns = dailyReturn(VXX, type="log")
indicator_df = data.frame(
sma,
cci,
cmo,
macd,
bbands,
fastK,
fastD,
slowD,
tdi,
trix,
volatility
)
indicator_df = indicator_df[complete.cases(indicator_df), ] # not lagged or logs
library(corrplot)
corrplot(cor(indicator_df, use = "complete.obs"), method = "number")
indicator_df2 = data.frame(
Delt(sma,type='arithmetic'),
Delt(cci,type='arithmetic'),
Delt(cmo,type='arithmetic'),
Delt(macd,type='arithmetic'),
Delt(bbands,type='arithmetic'),
Delt(fastD,type='arithmetic'),
Delt(slowD,type='arithmetic'),
Delt(tdi,type='arithmetic'),
Delt(volatility,type='arithmetic'),
Delt(data$Euro.Spot...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.TSA.Checkpoint.Numbers.Total.Traveler.Throughput...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Bloomberg.United.States.Financial.Conditions.Index...Last.Price..R2.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$CBOE.Equity.Put.Call.Ratio...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$US.Put.Call.Ratio.Composite...Last.Price..L1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Bloomberg.Cumulative.Advance.Decline.Line.for.S.P.500...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$McClellans.Advances...Declines.US.Index.Summation...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$S.P.500.Composite.Volume.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Cboe.Realized.Volatility.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Cboe.Implied.Correlation.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic"),
Delt(data$Base.Metals.Spot.Price.Index...Last.Price..R1.[1:which(data$date == "12/31/2020")],type = "arithmetic")
)
colnames(indicator_df2) <- c("sma", "cci", "cmo", "macd", "bbands", "fastD", "slowD", "tdi", "vol", "EuroSpot", "US TSA Numbers", "BBG Financial Conditions", "CBOE Equity Put/Call", "US Put Call Composite", "BBG Adv/Dec SPX", "US Adv/Dec", "SPX Composite Volume", "CBOE rVol", "CBOE Implied Cor.", "Base Metals Spot Index")
rownames(indicator_df2) <- rownames(price_data)
View(indicator_df2)
View(vxxReturns)
nrow(indicator_df2[1:(nrow(indicator_df2)-5),])
nrow(vxxReturns[6:(nrow(vxxReturns)),])
###########################################################################################################################
### This modifies the lag of the model - change 7 to what you want the lag to be, and change 6 to your desired lag - 1 on the next line
#############################################################################
lag = 5
lagged_df2 <- indicator_df2[1:(nrow(indicator_df2)-lag),]
lagged_df2$vxxReturns <-  vxxReturns[(lag+1):(nrow(vxxReturns)),]
lagged_df2 <- na.omit(lagged_df2)
lagged_df2 <- lagged_df2[!is.infinite(rowSums(lagged_df2)),]
View(lagged_df2)
#indicator_df2 = indicator_df2[-na.omit(indicator_df2), ]
corrplot(cor(lagged_df2, use = "complete.obs"), method = "pie")
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
lin.pred=predict(lin.mod,lagged_df2[train,])
mean((lin.pred-lagged_df2$vxxReturns[train])^2)
summary(lin.mod)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
train=sample(length(lagged_df2),length(lagged_df2)*.8,replace=FALSE) #Train/Test split
library(glmnet)
lin.mod = glm(lagged_df2$vxxReturns~.,data=lagged_df2,subset=train)
summary(lin.mod)
mean((lagged_df2$vxxReturns[train] - predict(lin.mod, lagged_df2[train,]))^2)
lin.pred=predict(lin.mod,lagged_df2[-train,])
mean((lin.pred-lagged_df2$vxxReturns[-train])^2)
library(BatchGetSymbols)
install.packages("BatchGetSymbols")
library(BatchGetSymbols)
#Step One: Get Price Data
# Data set for SPY only
tickers <- "SPY"
first.date <- as.Date("2018-01-25")-365 # - VXX data starts from 2018-01-25, but to get 1 year percent rank values for stocks and SPY we need to start 252 trading days earlier
last.date <- "2022-01-01"
l.out <- BatchGetSymbols(tickers = tickers,
first.date = first.date,
last.date = last.date, do.cache=FALSE, be.quiet = TRUE)
SPY_data <- data.frame(l.out$df.tickers)
# Data set for price of SPY and VIX only
tickers <- c("SPY", "VXX")
l.out <- BatchGetSymbols(tickers = tickers,
first.date = "2018-01-25",
last.date = last.date, do.cache=FALSE, be.quiet = TRUE)
price_data = data.frame(l.out$df.tickers$price.adjusted,l.out$df.tickers$ret.adjusted.prices, l.out$df.tickers$ref.date, l.out$df.tickers$ticker)
colnames(price_data) <- c("Value", "Daily Return", "Date", "Label")
# Data set including Open, Close, and Volume for both
complete_data <- data.frame(l.out$df.tickers)
######## Optional #######################
# Data set of SPY constituents
sp500 <- GetSP500Stocks() # constituents vary over time so this is a not a perfect implementation
tickers <- c(sp500$Tickers)
l.out <- BatchGetSymbols(tickers = tickers,
first.date = first.date,
last.date = last.date, do.cache=FALSE, be.quiet = TRUE)
constituents <- l.out$df.tickers
# Apply the indicators
library(TTR)
# all indicators related to the SPY
ema_20 = as.numeric(EMA(SPY_data$price.adjusted, n = 20))
ma_50 = as.numeric(SMA(SPY_data$price.adjusted, n = 50))
ma_200 = as.numeric(SMA(SPY_data$price.adjusted, n = 200))
aroon_ = as.numeric(aroon(SPY_data$price.adjusted, n = 20)) # using daily close, HL of day also possible
chaikinVol = as.numeric(chaikinVolatility(cbind(SPY_data$price.high,SPY_data$price.low), n = 20))
chaikinMF  = as.numeric(CMF(cbind(SPY_data$price.high,SPY_data$price.low,SPY_data$price.close),SPY_data$volume, n = 20))
chaikinAD  =  Delt(SMA(as.numeric(chaikinAD(cbind(SPY_data$price.high,SPY_data$price.low,SPY_data$price.close),SPY_data$volume)), 14)) # moving average of chaikin Adv/Dec
percentRank = as.numeric(runPercentRank(SPY_data$price.adjusted, n = 252))
RSI_ = as.numeric(RSI(SPY_data$price.adjusted, n = 20))
runningVar_EMA = EMA(as.numeric(runVar(SPY_data$price.adjusted, n = 20)),10)
runningVar_MA = SMA(as.numeric(runVar(SPY_data$price.adjusted, n = 20)),30)
indicator_df = cbind(
ema_20,
ma_50,
ma_200,
aroon_,
chaikinVol,
chaikinMF,
chaikinAD,
percentRank,
RSI_,
runningVar_EMA,
runningVar_MA
)
indicator_df <- data.frame(indicator_df)
indicator_df <- indicator_df[1:length(SPY_data$price.open),]
indicator_df <- cbind(indicator_df, SPY_data$price.adjusted,as.Date(SPY_data$ref.date))
indicator_df = indicator_df[complete.cases(indicator_df), ]
corrplot(cor(indicator_df[,1:11], use = "complete.obs"), method = "number")
# Apply the scoring system:
scores <- data.frame(matrix(nrow = nrow(indicator_df), ncol = 16))
colnames(scores) <- c("20_EMA", "50_SMA", "200_SMA", "20MA_vs_50_MA", "50MA_vs_200MA", "20MA_vs_200MA", "Aroon", "Chaikin Volatility", "Chaikin Money Flow", "Chaikin Advance/Decline", "RSI", "Percent Rank", "runVar", "Value", "Label" , "Date")
## Moving Average Scoring
# 20 EMA
scores$`20_EMA`[indicator_df$`SPY_data$price.adjusted` >= indicator_df$ema_20] <- 5
scores$`20_EMA`[indicator_df$`SPY_data$price.adjusted` < indicator_df$ema_20] <- -5
# 50 SMA
scores$`50_SMA`[indicator_df$`SPY_data$price.adjusted` >= indicator_df$ma_50] <- 10
scores$`50_SMA`[indicator_df$`SPY_data$price.adjusted` < indicator_df$ma_50] <- -10
# 200 SMA
scores$`200_SMA`[indicator_df$`SPY_data$price.adjusted` >= indicator_df$ma_200] <- 20
scores$`200_SMA`[indicator_df$`SPY_data$price.adjusted` < indicator_df$ma_200] <- -20
# 20 vs 50
scores$`20MA_vs_50_MA`[indicator_df$ema_20 >= indicator_df$ma_50] <- 10
scores$`20MA_vs_50_MA`[indicator_df$ema_20 < indicator_df$ma_50] <- -10
# 50 vs 200
scores$`50MA_vs_200MA`[indicator_df$ma_200 >= indicator_df$ma_50] <- -20
scores$`50MA_vs_200MA`[indicator_df$ma_200 < indicator_df$ma_50] <- 20
# 20 vs 200
scores$`20MA_vs_200MA`[indicator_df$ma_50 >= indicator_df$ma_200] <- 15
scores$`20MA_vs_200MA`[indicator_df$ma_50 < indicator_df$ma_200] <- -15
# Aroon
scores$Aroon[indicator_df$aroon_ <= 30] <- -5
scores$Aroon[indicator_df$aroon_ > 30] <- 0
scores$Aroon[indicator_df$aroon_ >= 70] <- 5
# Chaikin Volatility
scores$`Chaikin Volatility`[indicator_df$chaikinVol <= -.5] <- -6
scores$`Chaikin Volatility`[indicator_df$chaikinVol > -.5] <- -3
scores$`Chaikin Volatility`[indicator_df$chaikinVol >= .0] <- 3
scores$`Chaikin Volatility`[indicator_df$chaikinVol >= .5] <- 6
# Chaikin Money Flow
scores$`Chaikin Money Flow` <- 0
scores$`Chaikin Money Flow`[30 <= indicator_df$aroon_ & indicator_df$aroon_ <= -.25] <- -5
scores$`Chaikin Money Flow`[indicator_df$aroon_ >= 70 & indicator_df$chaikinMF >= 0.25] <- 5
# Chaikin Advance / Decline
scores$`Chaikin Advance/Decline`[indicator_df$Delt.1.arithmetic >= 0] <- 5
scores$`Chaikin Advance/Decline`[indicator_df$Delt.1.arithmetic < 0]  <- -5
# RSI
scores$RSI[indicator_df$RSI_ >= .0] <- -10
scores$RSI[indicator_df$RSI_ > .5] <- 10
# Percent Rank
scores$`Percent Rank`[indicator_df$percentRank >= 0] <- -10
scores$`Percent Rank`[indicator_df$percentRank >= .2] <- -5
scores$`Percent Rank`[indicator_df$percentRank >= .5] <- 5
scores$`Percent Rank`[indicator_df$percentRank >= .80] <- 10
# runVar
scores$runVar[indicator_df$runningVar_EMA >= indicator_df$runningVar_MA] <- -10
scores$runVar[indicator_df$runningVar_EMA < indicator_df$runningVar_MA] <- 0
# Total Score
for (i in 1:nrow(scores)){
scores$Value[i] <- sum(scores[i,1:13])
}
scores$Label <- "Score"
scores$Date <- indicator_df$`as.Date(SPY_data$ref.date)`
# Re-pull SPY and VXX Data if needed
tickers <- c("SPY", "VXX")
l.out <- BatchGetSymbols(tickers = tickers,
first.date = "2018-01-25",
last.date = last.date, do.cache=FALSE, be.quiet = TRUE)
price_data = data.frame(l.out$df.tickers$price.adjusted,l.out$df.tickers$ret.adjusted.prices, l.out$df.tickers$ref.date, l.out$df.tickers$ticker)
colnames(price_data) <- c("Value", "Daily Return", "Date", "Label")
# Compare score with price action
price_data <- price_data[,-2] # removing returns data
#score_time_series <- scores[-1,14:16]
# Smooth score with an EMA
score_EMA <- scores[,14:16]
score_EMA$Value <- EMA(scores$Value, n = 20)
score_EMA$Label <- "ScoreEMA"
# adding an MA for the crossover
score_MA <- scores[,14:16]
score_MA$Value <- EMA(scores$Value, n = 50)
score_MA$Label <- "Score50MA"
price_data <- rbind(price_data, score_EMA[-(1:19),],score_MA[-(1:49),]) # binding score, date, and label and removing first data point to match dates
library(ggplot2)
ggplot(price_data, aes(x = price_data$Date, y = price_data$Value, color = price_data$Label, group = price_data$Label))+geom_line()
# Apply the model to a portfolio - simple MA crossover
# Re-pull SPY and VXX Data if needed
tickers <- c("SPY", "VXX")
l.out <- BatchGetSymbols(tickers = tickers,
first.date = "2018-01-24",
last.date = last.date, do.cache=FALSE, be.quiet = TRUE)
price_data = data.frame(l.out$df.tickers$price.adjusted,l.out$df.tickers$ret.adjusted.prices, l.out$df.tickers$ref.date, l.out$df.tickers$ticker)
colnames(price_data) <- c("Value", "Daily Return", "Date", "Label")
risk_status <- scores[,14:16]
risk_status$Value <- 0
risk_status$Value[score_EMA$Value >= score_MA$Value] <- 1
portfolio <- scores[,14:16]
portfolio$Value <- 100
for(i in 49:nrow(portfolio)){
if (risk_status$Value[i] == 1){
portfolio$Value[i] <- portfolio$Value[i-1] * (1+price_data$`Daily Return`[i])
} else {
portfolio$Value[i] <- portfolio$Value[i-1]
}
}
portfolio$Label <- "Portfolio"
# Set up SPY portfolio
SPY_portfolio <- scores[,14:16]
SPY_portfolio$Value <- 100
for(i in 49:nrow(SPY_portfolio)){
SPY_portfolio$Value[i] <- SPY_portfolio$Value[i-1] * (1+price_data$`Daily Return`[i])
}
SPY_portfolio$Label <- "SPY Portfolio"
# Rebind everything
price_data <- price_data[,-2]
price_data <- rbind(price_data, score_EMA[-(1:19),],portfolio[-(1:49),],SPY_portfolio[-(1:49),],score_MA[-(1:49),]) # binding score, date, and label and removing first data point to match dates
ggplot(price_data, aes(x = price_data$Date, y = price_data$Value, color = price_data$Label, group = price_data$Label))+geom_line()
View(SPY_portfolio)
port_comp <- rbind(SPY_portfolio[-(1:49),], portfolio[-(1:49),])
ggplot(port_comp, aes(x = port_comp$Date, y = port_comp$Value, color = port_comp$Label, group = port_comp$Label))+geom_line()
# Comparing the sharpe ratios and returns
sharpe_ratios <- data.frame(as.matrix(0,2,2))
sharpe_ratios$as.matrix.0..2..2.[1] <- mean(Delt(portfolio$Value[-(1:489)])[-1])/sd(Delt(portfolio$Value[-(1:489)])[-1])
sharpe_ratios$as.matrix.0..2..3.[1] <- mean(Delt(SPY_portfolio$Value[-(1:489)])[-1])/sd(Delt(SPY_portfolio$Value[-(1:489)])[-1])
colnames(sharpe_ratios) <- c("Portfolio Daily Sharpe", "SPY Daily Sharpe")
sharpe_ratios_annualized <- sharpe_ratios *sqrt(252)
colnames(sharpe_ratios_annualized) <- c("Portfolio Sharpe Annualized", "SPY Sharpe Annualized")
View(sharpe_ratios_annualized)
gc()
